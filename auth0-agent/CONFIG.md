# Configuration Management

## Agent Base URL Configuration

The agent application base URL (`http://localhost:3003`) is centralized to make it easy to change across the entire project.

### Quick Change Guide

To change the agent base URL from `http://localhost:3003` to another value:

1. **Update the shared configuration file:**

   ```bash
   # Edit auth0-agent/config.sh
   export AGENT_BASE_URL="http://your-new-url:port"
   ```

2. **Update the API server environment:**

   ```bash
   # Edit apps/api-server/.env
   AGENT_BASE_URL=http://your-new-url:port
   ```

3. **Regenerate configuration files:**

   ```bash
   cd auth0-agent
   ./scripts/generate-auth-management-client.sh
   ./scripts/generate-web-env.sh
   ```

4. **Apply Terraform changes:**
   ```bash
   cd auth0-agent/terraform
   terraform apply
   ```

### Files That Use This Configuration

#### Source Configuration Files

- `auth0-agent/config.sh` - Shared bash configuration (sourced by scripts)
- `apps/api-server/.env` - API server environment variables

#### Files That Reference The Configuration

- `auth0-agent/init.sh` - Sources `config.sh`, uses in echo statements
- `auth0-agent/scripts/generate-auth-management-client.sh` - Sources `config.sh`
- `auth0-agent/scripts/generate-web-env.sh` - Sources `config.sh`
- `auth0-agent/terraform/variables.tf` - Defines default values (overridden by tfvars)
- `auth0-agent/terraform/outputs.tf` - References the variable
- `apps/api-server/src/config.ts` - Reads from environment variable
- `apps/api-server/src/server.ts` - Uses config for CORS

#### Generated Files (Auto-updated by scripts)

- `auth0-agent/terraform/terraform.tfvars` - Generated by `generate-auth-management-client.sh`
  - Sets `agent_base_url`, `agent_callback_url`, and `mcp_resource_identifier`
- `apps/agent/.env` - Generated by `generate-web-env.sh`

### Architecture

```
┌─────────────────────────────┐
│  auth0-agent/config.sh      │  ← Change AGENT_BASE_URL here
│  AGENT_BASE_URL=...         │
└──────────────┬──────────────┘
               │
               ├──────────────────────────────┐
               │                              │
               ▼                              ▼
┌──────────────────────────┐   ┌─────────────────────────┐
│  Bash Scripts            │   │  Terraform              │
│  • generate-auth-...sh   │   │  • variables.tf         │
│  • generate-web-env.sh   │   │  • outputs.tf           │
└──────────┬───────────────┘   └────────┬────────────────┘
           │                            │
           ▼                            ▼
   ┌──────────────────┐        ┌──────────────────┐
   │ Generated Files  │        │ Terraform State  │
   │ • tfvars         │        │ • Resources      │
   │ • .env           │        └──────────────────┘
   └──────────────────┘

┌────────────────────────────┐
│  apps/api-server/.env      │  ← Also change here
│  AGENT_BASE_URL=...        │
└──────────┬─────────────────┘
           │
           ▼
┌──────────────────────────┐
│  API Server Config       │
│  src/config.ts           │
└──────────┬───────────────┘
           │
           ▼
┌──────────────────────────┐
│  CORS Configuration      │
│  src/server.ts           │
└──────────────────────────┘
```

### Notes

- The bash scripts automatically derive callback URLs and audience values from the base URL
- The MCP resource identifier is automatically set to `${AGENT_BASE_URL}/mcp`
- After changing the configuration, restart any running development servers
- For production deployments, ensure environment variables are properly set in your deployment platform
- **Terraform variables**: The default values in `terraform/variables.tf` are placeholders. The actual values are set in `terraform.tfvars` (generated by the bash scripts) which override these defaults
